# Usage

## Configuration

First of all, we will create new Angular project using the CLI then we will add
the dependencies of nge-markdown to the project.

* Generate the project

  ```bash
  ng new my-project
  ```

* Add **nge-markdown** and **marked** dependencies from npm

  ```bash
  npm i nge-markdown marked
  ```

* Once the project is generated, open the **app.module.ts** file and add **NgeMarkdownModule** to the **imports**
  array  of the module.
  If you want to load markdown data from files you must also add **HttpClientModule** to the imports.

  ```typescript highlights="13-14"
  import { BrowserModule } from '@angular/platform-browser';
  import { NgModule } from '@angular/core';
  import { HttpClientModule } from '@angular/common/http';
  import { NgeMarkdownModule} from 'nge-markdown';
  import { AppComponent } from './app.component';

  @NgModule({
    declarations: [
      AppComponent,
    ],
    imports: [
      BrowserModule,
      HttpClientModule,
      NgeMarkdownModule,
    ],
    providers: [],
    bootstrap: [AppComponent]
  })
  export class AppModule { }
  ```

## Integration

You can use `<nge-markdown></nge-markdown>` component to either parse static markdown directly from your HTML markup
using the [transclusion](https://ultimatecourses.com/blog/transclusion-in-angular-2-with-ng-content) technique, load the content from a remote URL using `[file]` input or bind a variable to your component using `[data]` input.

You can get a hook on render complete using `(render)` output event to get the ast generated by `marked` parser.

=== app.component.ts

```typescript
import { Component, OnInit } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { MarkedTokensList  } from 'nge-markdown';

@Component({
    selector: 'app-root',
    templateUrl: './app.component.html',
    styleUrls: ['./app.component.scss'],
})
export class AppComponent {
  markdown = `
  This is a simple markdown from a variable
  # H1
  ## H2
  ### H3
  `;

  onRender(ast: MarkedTokensList) {
    console.log(ast);
  }
}
```

=== app.component.html

```html
<!-- render markdown from a variable -->
<nge-markdown [data]="markdown" (render)="onRender($event)"></nge-markdown>

<!-- render markdown from a file -->
<nge-markdown [file]="'assets/markdown.md'" (render)="onRender($event)"></nge-markdown>

<!-- render markdown using tranclusion -->
<nge-markdown ngPreserveWhitespaces (render)="onRender($event)">
This is a simple markdown from rendered using the transclusion technique.

# H1
## H2
### H3
</nge-markdown>
```

=== assets/markdown.md

```markdown
This is a simple markdown from a file

# H1
## H2
### H3
```

===

:::+ note ngPreserveWhitespaces
As of Angular 6, the template compiler strips whitespace by default. Use `ngPreserveWhitespaces` directive to preserve whitespaces such as newlines in order for the markdown-formatted content to render as intended.
https://angular.io/api/core/Component#preserveWhitespaces
:::

:::+ note Escape html when using transclusion
Characters such as &lt;, &gt;, {, } directly written in the HTML template file must be escaped so that the compiler doesn't try to bind it as regular Angular code.
:::

:::+ note Theming
When you use `<nge-markdown></nge-markdown>` component a default theme is applied
to the generated markdown. The theme is inspired from [github theme](https://github.com/sindresorhus/github-markdown-css/blob/gh-pages/github-markdown.css).

If you don't want this theme to be applied, you can set the `[theme]` input to `'none'`.
:::

:::+ note NgeMarkdownService
You can also use the `NgeMarkdownService` service to compile the markdown yourself if you don't want to use
`<nge-markdown></nge-markdown>` component.
:::

## Options

Optionally, marked parser can be configured by passing a custom [MarkedOptions](https://marked.js.org/#/USING_ADVANCED.md#options) to the `NGE_MARKDOWN_CONFIG` configuration object using the `providers` array of your application main module.

```typescript highlights="4 17-26"
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';
import { NgeMarkdownModule, NGE_MARKDOWN_CONFIG, NgeMarkdownConfig } from 'nge-markdown';
import { AppComponent } from './app.component';

@NgModule({
  declarations: [
    AppComponent,
  ],
  imports: [
    BrowserModule,
    HttpClientModule,
    NgeMarkdownModule,
  ],
  providers: [
    {
      provide: NGE_MARKDOWN_CONFIG,
      // https://marked.js.org/#/USING_ADVANCED.md#options
      useValue: {
        breaks: false,
        pedantic: false,
        smartLists: true,
        smartypants: false,
      } as NgeMarkdownConfig
    }
  ],
  bootstrap: [AppComponent]
})
export class AppModule { }
```

:::+ note Note
The properties `highlight` and `langPrefix` are removed from the MarkedOptions object because they are used by the nge-markdown lib itself
so you cannot override theses properties.
:::

You can also use a factory provider in the case where you want to compute
marked `renderer` and `tokenizer`.

```typescript highlights="4 7-25 37-40"
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';
import { NgeMarkdownModule, NGE_MARKDOWN_CONFIG, NgeMarkdownConfig } from 'nge-markdown';
import { AppComponent } from './app.component';

export function markedOptionsFactory(): MarkedOptions {
  const renderer = new MarkedRenderer();
  const tokenizer = new MarkedTokenizer();

  renderer.blockquote = (text: string) => {
    return '<blockquote class="blockquote"><p>' + text + '</p></blockquote>';
  };

  // transform the tokenizer here

  return {
    renderer,
    tokenizer,
    breaks: false,
    pedantic: false,
    smartLists: true,
    smartypants: false,
  };
}

@NgModule({
  declarations: [
    AppComponent,
  ],
  imports: [
    BrowserModule,
    HttpClientModule,
    NgeMarkdownModule,
  ],
  providers: [
    {
      provide: NGE_MARKDOWN_CONFIG,
      useFactory: markedOptionsFactory
    }
  ],
  bootstrap: [AppComponent]
})
export class AppModule { }
```
